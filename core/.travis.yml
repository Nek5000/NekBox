language: fortran

env:
 - TEST_SUITE=RTI-LST
 - TEST_SUITE=lid
 - TEST_SUITE=iturb
 - TEST_SUITE=Hill
 - TEST_SUITE=duct
 - TEST_SUITE=corner
 - TEST_SUITE=eddy

before_install: 
 - mkdir -p $HOME/NekBox
 - mv * $HOME/NekBox
 - cd $HOME
 - sudo apt-get update -qq
 - sudo apt-get install -y mpich2 libmpich2-dev 
 - sudo apt-get install -y liblapack-dev
 - sudo apt-get install -y fftw3-dev
 - sudo apt-get install -y gfortran 
 - git clone https://github.com/maxhutch/nek-tests.git
 - git clone https://github.com/maxhutch/nek-tools.git
 - git clone https://github.com/maxhutch/nek-analyze.git
 - git clone -b async https://github.com/maxhutch/gslib.git
 - cd gslib
 - make
 - cd $HOME 

install:
 - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
 - bash miniconda.sh -b -p $HOME/miniconda
 - export PATH="$HOME/miniconda/bin:$PATH"
 - hash -r
 - conda config --set always_yes yes --set changeps1 no
 - conda update -q conda
 - conda info -a
 - conda create -q -n test-environment python=3.4 numpy
 - source activate test-environment
 - conda install pytest chest cloudpickle
 - pip install graphviz mapcombine
 - pip install git+https://github.com/maxhutch/dask --upgrade
 - pip install git+https://github.com/maxhutch/nekpy --upgrade

script: 
 - py.test -v -m "not pr"  nek-tests/$TEST_SUITE
